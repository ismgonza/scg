document.addEventListener("DOMContentLoaded", function() {
    const radios = document.querySelectorAll('input[type="radio"]');
    if (radios.length === 0) {
        console.error("No radio inputs found in the document.");
        return;
    }
    
    // Function to fetch data
    function fetchDataAndUpdateTable(reportId, chartId) {
        updateReportIds(reportId)
        fetchData(reportId)
            .then(fetchedData => {
                if (fetchedData) {
                    // Load tables
                    generateTopAlertsTable(fetchedData.alert_report, 1, 10, 'top_alerts');
                    renderTable(fetchedData.alert_report, 'vuln_by_target', 'target_affected', 'Host');
                    renderTable(fetchedData.alert_report, 'vuln_by_os', 'os', 'Operating System');
                    // Load Charts
                    drawChart(document.getElementById('vuln_by_risk').getContext('2d'), calculateCounts(fetchedData.alert_report));
                    drawPieChart(document.getElementById('os_count').getContext('2d'), getOSCounts(fetchedData.alert_report));
                } else {
                    console.error("Failed to fetch data or alert_report is missing.");
                }
            })
            .catch(error => {
                console.error("Error fetching or processing data:", error);
            });
    }

    // Fetch data onload with the value of the first row of the table
    const defaultReportId = radios[0].value;
    fetchDataAndUpdateTable(defaultReportId);

    // Add event listeners to radio buttons
    radios.forEach(radio => {
        radio.addEventListener("change", function() {
            const reportId = this.value;
            fetchDataAndUpdateTable(reportId);
        });
    });
});


function updateReportIds(reportId) {
    const reportIds = document.querySelectorAll('.reportId');
    reportIds.forEach(reportIdElement => {
        reportIdElement.textContent = reportId;
    });
}