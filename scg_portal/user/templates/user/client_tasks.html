{% extends "base.html" %}
{% load static %}

{% block title %} 
    Dasboard - {{ nombre_cuenta }}
{% endblock %}

{% block content %}

    <main>
        <div class="container charts">
            <div class="row heading-row">
                <div class="col heading-row">
                    <h1 class="text-center">Service Requests</h1>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <p class="text-center">Welcome to our Service Request Tickets section!<br><br>Here, you'll find a list of all your service requests for easy tracking.<br><br>Click on a task ID to view its status, updates, and level of effort.<br>Have questions or need help? Contact our support team for assistance or create a ticket.<br><br>Thank you for choosing us!</p>
                </div>
            </div>
            <div class="row">
                <div class="col"><a class="btn btn-primary" role="button" href="#" data-bs-target="#log-ticket-cust" data-bs-toggle="modal" style="background: #3a8dde;">Create a Ticket</a></div>
            </div>
            <div class="modal fade modal_format" role="dialog" tabindex="-1" id="log-ticket-cust">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">Please fill all the blanks and you will be reached out soon</h4><button class="btn-close" type="button" aria-label="Close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <form class="d-flex flex-column" style="padding: 10px;" method="post" action="{% url 'crear_tarea_client' nombre_cuenta=nombre_cuenta %}">
                                {% csrf_token %}
                                <div><label class="form-label" for="name" data-i18n="section_contact.form_name">Subject</label><input type="text" id="name-1" required="" name="incidente"></div>
                                <div></div>
                                <div><label class="form-label" data-i18n="section_contact.form_email" for="email">Severity:</label><select class="form-select" name="severity">
                                        <option value="3">3 - High</option>
                                        <option value="2">2 - Medium</option>
                                        <option value="1" selected="">1 - Low</option>
                                    </select></div>
                                <div><label class="form-label" data-i18n="section_contact.form_message" for="message">Please describe the request:</label><textarea class="form-control" id="message-1" maxlength="300" rows="6" name="descripcion"></textarea></div>
                                <button class="btn btn-primary justify-content-center justify-content-lg-center" type="submit" style="background: #3a8dde;border-style: none;max-width: 50%;margin-right: 25%;margin-left: 25%;margin-top: 15px;margin-bottom: 15px;" data-i18n="section_contact.form_button">Submit</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Task ID</th>
                                    <th>Severity</th>
                                    <th>Date Created</th>
                                    <th>Description</th>
                                    <th>Status</th>
                                    <th>Total LOE</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for tarea in paginator_tasks %}
                                    <tr>
                                        <td><a href="{% url 'view_task' nombre_cuenta=tarea.cuenta_tarea.nombre id_tarea=tarea.id_tarea %}">{{ tarea.id_tarea }}</a></td>
                                        <td><span style="font-weight: normal !important; font-style: normal !important;">{{ tarea.severity }}</span></td>
                                        <td><span style="font-weight: normal !important; font-style: normal !important;">{{ tarea.fecha }}</span></td>
                                        <td>{{ tarea.descripcion }}</td>
                                        <td>{{ tarea.status }}</td>
                                        <td>{{ tarea.loe }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <nav class="d-xl-flex justify-content-xl-end">
                        <ul class="pagination pagination-sm">
                            {% if paginator_tasks.has_previous %}
                                <li class="page-item"><a class="page-link" href="?page=1" aria-label="First"><span aria-hidden="true">««</span></a></li>
                                <li class="page-item"><a class="page-link" href="?page={{ paginator_tasks.previous_page_number }}" aria-label="Previous"><span aria-hidden="true">«</span></a></li>
                            {% endif %}
                            
                            {% for num in paginator_tasks.paginator.page_range %}
                                <li class="page-item{% if paginator_tasks.number == num %} active{% endif %}"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                            {% endfor %}
                            
                            {% if paginator_tasks.has_next %}
                                <li class="page-item"><a class="page-link" href="?page={{ paginator_tasks.next_page_number }}" aria-label="Next"><span aria-hidden="true">»</span></a></li>
                                <li class="page-item"><a class="page-link" href="?page={{ paginator_tasks.paginator.num_pages }}" aria-label="Last"><span aria-hidden="true">»»</span></a></li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </main>
    
{% endblock %}